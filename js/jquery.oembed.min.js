/*!
 * jquery oembed plugin
 *
 * Copyright (c) 2009 Richard Chamorro
 * Licensed under the MIT license
 * 
 * Orignal Author: Richard Chamorro 
 * Forked by Andrew Mee to Provide a slightly diffent kind of embedding 
 * experience
 */(function(e){function n(e,t){t=t?t:"";return e?n(--e,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(Math.random()*60))+t):t}function r(e,t){var n=e.apiendpoint,r="",i;n+=n.indexOf("?")<=0?"?":"&";n=n.replace("#","%23");e.maxWidth!==null&&(typeof e.params.maxwidth=="undefined"||e.params.maxwidth===null)&&(e.params.maxwidth=e.maxWidth);e.maxHeight!==null&&(typeof e.params.maxheight=="undefined"||e.params.maxheight===null)&&(e.params.maxheight=e.maxHeight);for(i in e.params){if(i==e.callbackparameter)continue;e.params[i]!==null&&(r+="&"+escape(i)+"="+e.params[i])}n+="format="+e.format+"&url="+escape(t)+r;e.dataType!="json"&&(n+="&"+e.callbackparameter+"=?");return n}function i(n,r,i){e("#jqoembeddata").data(r,n.code);t.beforeEmbed.call(i,n);t.onEmbed.call(i,n);t.afterEmbed.call(i,n)}function s(s,o,u){if(e("#jqoembeddata").data(o)!=undefined&&u.embedtag.tag!="iframe"){var a={code:e("#jqoembeddata").data(o)};i(a,o,s)}else if(u.yql){var f=u.yql.from||"htmlstring",l=u.yql.url?u.yql.url(o):o,c="SELECT * FROM "+f+' WHERE url="'+l+'"'+" and "+(/html/.test(f)?"xpath":"itemPath")+"='"+(u.yql.xpath||"/")+"'";f=="html"&&(c+=" and compat='html5'");var h=e.extend({url:"http://query.yahooapis.com/v1/public/yql",dataType:"jsonp",data:{q:c,format:"json",env:"store://datatables.org/alltableswithkeys",callback:"?"},success:function(t){var n;if(u.yql.xpath&&u.yql.xpath=="//meta|//title|//link"){var r={};t.query.results==null&&(t.query.results={meta:[]});for(var a=0,f=t.query.results.meta.length;a<f;a++){var c=t.query.results.meta[a].name||t.query.results.meta[a].property||null;if(c==null)continue;r[c.toLowerCase()]=t.query.results.meta[a].content}(!r.hasOwnProperty("title")||!r.hasOwnProperty("og:title"))&&t.query.results.title!=null&&(r.title=t.query.results.title);if(!r.hasOwnProperty("og:image")&&t.query.results.hasOwnProperty("link"))for(var a=0,f=t.query.results.link.length;a<f;a++)t.query.results.link[a].hasOwnProperty("rel")&&t.query.results.link[a].rel=="apple-touch-icon"&&(t.query.results.link[a].href.charAt(0)=="/"?r["og:image"]=l.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1]+t.query.results.link[a].href:r["og:image"]=t.query.results.link[a].href);n=u.yql.datareturn(r)}else n=u.yql.datareturn?u.yql.datareturn(t.query.results):t.query.results.result;if(n===!1)return;var h=e.extend({},n);h.code=n;i(h,o,s)},error:t.onError.call(s,o,u)},t.ajaxOptions||{});e.ajax(h)}else if(u.templateRegex)if(u.embedtag.tag!==""){var p=u.embedtag.flashvars||"",d=u.embedtag.tag||"embed",v=u.embedtag.width||"auto",m=u.embedtag.nocache||0,g=u.embedtag.height||"auto",y=o.replace(u.templateRegex,u.apiendpoint);u.nocache||(y+="&jqoemcache="+n(5));u.apikey&&(y=y.replace("_APIKEY_",t.apikeys[u.name]));var b=e("<"+d+"/>").attr("src",y).attr("width",v).attr("height",g).attr("allowfullscreen",u.embedtag.allowfullscreen||"true").attr("allowscriptaccess",u.embedtag.allowfullscreen||"always").css("max-height",t.maxHeight||"auto").css("max-width",t.maxWidth||"auto");d=="embed"&&b.attr("type",u.embedtag.type||"application/x-shockwave-flash").attr("flashvars",o.replace(u.templateRegex,p));d=="iframe"&&b.attr("scrolling",u.embedtag.scrolling||"no").attr("frameborder",u.embedtag.frameborder||"0");var a={code:b};i(a,o,s)}else if(u.apiendpoint){u.apikey&&(u.apiendpoint=u.apiendpoint.replace("_APIKEY_",t.apikeys[u.name]));h=e.extend({url:o.replace(u.templateRegex,u.apiendpoint),dataType:"jsonp",success:function(t){var n=e.extend({},t);n.code=u.templateData(t);i(n,o,s)},error:t.onError.call(s,o,u)},t.ajaxOptions||{});e.ajax(h)}else{var a={code:o.replace(u.templateRegex,u.template)};i(a,o,s)}else{var w=r(u,o),h=e.extend({url:w,dataType:u.dataType||"jsonp",success:function(t){var n=e.extend({},t);switch(n.type){case"file":case"photo":n.code=e.fn.oembed.getPhotoCode(o,n);break;case"video":case"rich":n.code=e.fn.oembed.getRichCode(o,n);break;default:n.code=e.fn.oembed.getGenericCode(o,n)}i(n,o,s)},error:t.onError.call(s,o,u)},t.ajaxOptions||{});e.ajax(h)}}function o(e){if(e===null)return null;var t,n={};for(t in e)t!==null&&(n[t.toLowerCase()]=e[t]);return n}e.fn.oembed=function(n,r,i){t=e.extend(!0,e.fn.oembed.defaults,r);var u=["0rz.tw","1link.in","1url.com","2.gp","2big.at","2tu.us","3.ly","307.to","4ms.me","4sq.com","4url.cc","6url.com","7.ly","a.gg","a.nf","aa.cx","abcurl.net","ad.vu","adf.ly","adjix.com","afx.cc","all.fuseurl.com","alturl.com","amzn.to","ar.gy","arst.ch","atu.ca","azc.cc","b23.ru","b2l.me","bacn.me","bcool.bz","binged.it","bit.ly","bizj.us","bloat.me","bravo.ly","bsa.ly","budurl.com","canurl.com","chilp.it","chzb.gr","cl.lk","cl.ly","clck.ru","cli.gs","cliccami.info","clickthru.ca","clop.in","conta.cc","cort.as","cot.ag","crks.me","ctvr.us","cutt.us","dai.ly","decenturl.com","dfl8.me","digbig.com","http://digg.com/[^/]+$","disq.us","dld.bz","dlvr.it","do.my","doiop.com","dopen.us","easyuri.com","easyurl.net","eepurl.com","eweri.com","fa.by","fav.me","fb.me","fbshare.me","ff.im","fff.to","fire.to","firsturl.de","firsturl.net","flic.kr","flq.us","fly2.ws","fon.gs","freak.to","fuseurl.com","fuzzy.to","fwd4.me","fwib.net","g.ro.lt","gizmo.do","gl.am","go.9nl.com","go.ign.com","go.usa.gov","goo.gl","goshrink.com","gurl.es","hex.io","hiderefer.com","hmm.ph","href.in","hsblinks.com","htxt.it","huff.to","hulu.com","hurl.me","hurl.ws","icanhaz.com","idek.net","ilix.in","is.gd","its.my","ix.lt","j.mp","jijr.com","kl.am","klck.me","korta.nu","krunchd.com","l9k.net","lat.ms","liip.to","liltext.com","linkbee.com","linkbun.ch","liurl.cn","ln-s.net","ln-s.ru","lnk.gd","lnk.ms","lnkd.in","lnkurl.com","lru.jp","lt.tl","lurl.no","macte.ch","mash.to","merky.de","migre.me","miniurl.com","minurl.fr","mke.me","moby.to","moourl.com","mrte.ch","myloc.me","myurl.in","n.pr","nbc.co","nblo.gs","nn.nf","not.my","notlong.com","nsfw.in","nutshellurl.com","nxy.in","nyti.ms","o-x.fr","oc1.us","om.ly","omf.gd","omoikane.net","on.cnn.com","on.mktw.net","onforb.es","orz.se","ow.ly","ping.fm","pli.gs","pnt.me","politi.co","post.ly","pp.gg","profile.to","ptiturl.com","pub.vitrue.com","qlnk.net","qte.me","qu.tc","qy.fi","r.ebay.com","r.im","rb6.me","read.bi","readthis.ca","reallytinyurl.com","redir.ec","redirects.ca","redirx.com","retwt.me","ri.ms","rickroll.it","riz.gd","rt.nu","ru.ly","rubyurl.com","rurl.org","rww.tw","s4c.in","s7y.us","safe.mn","sameurl.com","sdut.us","shar.es","shink.de","shorl.com","short.ie","short.to","shortlinks.co.uk","shorturl.com","shout.to","show.my","shrinkify.com","shrinkr.com","shrt.fr","shrt.st","shrten.com","shrunkin.com","simurl.com","slate.me","smallr.com","smsh.me","smurl.name","sn.im","snipr.com","snipurl.com","snurl.com","sp2.ro","spedr.com","srnk.net","srs.li","starturl.com","stks.co","su.pr","surl.co.uk","surl.hu","t.cn","t.co","t.lh.com","ta.gd","tbd.ly","tcrn.ch","tgr.me","tgr.ph","tighturl.com","tiniuri.com","tiny.cc","tiny.ly","tiny.pl","tinylink.in","tinyuri.ca","tinyurl.com","tk.","tl.gd","tmi.me","tnij.org","tnw.to","tny.com","to.ly","togoto.us","totc.us","toysr.us","tpm.ly","tr.im","tra.kz","trunc.it","twhub.com","twirl.at","twitclicks.com","twitterurl.net","twitterurl.org","twiturl.de","twurl.cc","twurl.nl","u.mavrev.com","u.nu","u76.org","ub0.cc","ulu.lu","updating.me","ur1.ca","url.az","url.co.uk","url.ie","url360.me","url4.eu","urlborg.com","urlbrief.com","urlcover.com","urlcut.com","urlenco.de","urli.nl","urls.im","urlshorteningservicefortwitter.com","urlx.ie","urlzen.com","usat.ly","use.my","vb.ly","vevo.ly","vgn.am","vl.am","vm.lc","w55.de","wapo.st","wapurl.co.uk","wipi.es","wp.me","x.vu","xr.com","xrl.in","xrl.us","xurl.es","xurl.jp","y.ahoo.it","yatuc.com","ye.pe","yep.it","yfrog.com","yhoo.it","yiyd.com","youtu.be","yuarel.com","z0p.de","zi.ma","zi.mu","zipmyurl.com","zud.me","zurl.ws","zz.gd","zzang.kr","›.ws","✩.ws","✿.ws","❥.ws","➔.ws","➞.ws","➡.ws","➨.ws","➯.ws","➹.ws","➽.ws"];e("#jqoembeddata").length===0&&e('<span id="jqoembeddata"></span>').appendTo("body");return this.each(function(){var r=e(this),a=n&&(!n.indexOf("http://")||!n.indexOf("https://"))?n:r.attr("href"),f;i?t.onEmbed=i:t.onEmbed||(t.onEmbed=function(n){e.fn.oembed.insertCode(this,t.embedMethod,n)});if(a!==null&&a!==undefined){for(var l=0,c=u.length;l<c;l++){var h=new RegExp("://"+u[l]+"/","i");if(a.match(h)!==null){var p=e.extend({url:"http://api.longurl.org/v2/expand",dataType:"jsonp",data:{url:a,format:"json"},success:function(n){a=n["long-url"];f=e.fn.oembed.getOEmbedProvider(n["long-url"]);if(f!==null){f.params=o(t[f.name])||{};f.maxWidth=t.maxWidth;f.maxHeight=t.maxHeight;s(r,a,f)}else t.onProviderNotFound.call(r,a)}},t.ajaxOptions||{});e.ajax(p);return r}}f=e.fn.oembed.getOEmbedProvider(a);if(f!==null){f.params=o(t[f.name])||{};f.maxWidth=t.maxWidth;f.maxHeight=t.maxHeight;s(r,a,f)}else t.onProviderNotFound.call(r,a)}return r})};var t;e.fn.oembed.defaults={maxWidth:null,maxHeight:null,includeHandle:!0,embedMethod:"auto",onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:!1,onError:function(){},ajaxOptions:{}};e.fn.oembed.insertCode=function(n,r,i){if(i===null)return;r=="auto"&&n.attr("href")!==null?r="append":r=="auto"&&(r="replace");switch(r){case"replace":n.replaceWith(i.code);break;case"fill":n.html(i.code);break;case"append":n.wrap('<div class="oembedall-container"></div>');var s=n.parent();t.includeHandle&&e('<span class="oembedall-closehide">&darr;</span>').insertBefore(n).click(function(){var t=encodeURIComponent(e(this).text());e(this).html(t=="%E2%86%91"?"&darr;":"&uarr;");e(this).parent().children().last().toggle()});s.append("<br/>");try{i.code.clone().appendTo(s)}catch(o){s.append(i.code)}if(t.maxWidth){var u=s.parent().width();if(u<t.maxWidth){var a=e("iframe",s).width(),f=e("iframe",s).height(),l=a/u;e("iframe",s).width(a/l);e("iframe",s).height(f/l)}else{t.maxWidth&&e("iframe",s).width(t.maxWidth);t.maxHeight&&e("iframe",s).height(t.maxHeight)}}}};e.fn.oembed.getPhotoCode=function(e,t){var n,r=t.title?t.title:"";r+=t.author_name?" - "+t.author_name:"";r+=t.provider_name?" - "+t.provider_name:"";if(t.url)n='<div><a href="'+e+"\" target='_blank'><img src=\""+t.url+'" alt="'+r+'"/></a></div>';else if(t.thumbnail_url){var i=t.thumbnail_url.replace("_s","_b");n='<div><a href="'+e+"\" target='_blank'><img src=\""+i+'" alt="'+r+'"/></a></div>'}else n="<div>Error loading this picture</div>";t.html&&(n+="<div>"+t.html+"</div>");return n};e.fn.oembed.getRichCode=function(e,t){var n=t.html;return n};e.fn.oembed.getGenericCode=function(e,t){var n=t.title!==null?t.title:e,r='<a href="'+e+'">'+n+"</a>";t.html&&(r+="<div>"+t.html+"</div>");return r};e.fn.oembed.getOEmbedProvider=function(t){for(var n=0;n<e.fn.oembed.providers.length;n++)for(var r=0,i=e.fn.oembed.providers[n].urlschemes.length;r<i;r++){var s=new RegExp(e.fn.oembed.providers[n].urlschemes[r],"i");if(t.match(s)!==null)return e.fn.oembed.providers[n]}return null};e.fn.oembed.OEmbedProvider=function(e,t,n,r,i){this.name=e;this.type=t;this.urlschemes=n;this.apiendpoint=r;this.maxWidth=500;this.maxHeight=400;i=i||{};if(i.useYQL){i.useYQL=="xml"?i.yql={xpath:"//oembed/html",from:"xml",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=xml&url="+e},datareturn:function(e){return e.html.replace(/.*\[CDATA\[(.*)\]\]>$/,"$1")||""}}:i.yql={from:"json",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=json&url="+e},datareturn:function(e){return e.json.type!="video"&&(e.json.url||e.json.thumbnail_url)?'<img src="'+(e.json.url||e.json.thumbnail_url)+'" />':e.json.html||""}};this.apiendpoint=null}for(var s in i)this[s]=i[s];this.format=this.format||"json";this.callbackparameter=this.callbackparameter||"callback";this.embedtag=this.embedtag||{tag:""}};e.fn.updateOEmbedProvider=function(t,n,r,i,s){for(var o=0;o<e.fn.oembed.providers.length;o++)if(e.fn.oembed.providers[o].name===t){n!==null&&(e.fn.oembed.providers[o].type=n);r!==null&&(e.fn.oembed.providers[o].urlschemes=r);i!==null&&(e.fn.oembed.providers[o].apiendpoint=i);if(s!==null){e.fn.oembed.providers[o].extraSettings=s;for(var u in s)u!==null&&s[u]!==null&&(e.fn.oembed.providers[o][u]=s[u])}}};e.fn.oembed.providers=[new e.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?","youtu\\.be/[\\w-]+","youtube.com/embed"],"http://www.youtube.com/embed/$1?wmode=transparent",{templateRegex:/.*(?:v\=|be\/|embed\/)([\w\-]+)&?.*/,embedtag:{tag:"iframe",width:"530",height:"349"}}),new e.fn.oembed.OEmbedProvider("opengraph","rich",[".*"],null,{yql:{xpath:"//meta|//title|//link",from:"html",datareturn:function(n){!n["og:title"]&&n.title&&n.description&&(n["og:title"]=n.title);if(!n["og:title"]&&!n.title)return!1;var r=e("<p/>");if(n["og:video"]){var i=e('<embed src="'+n["og:video"]+'"/>');i.attr("type",n["og:video:type"]||"application/x-shockwave-flash").css("max-height",t.maxHeight||"auto").css("max-width",t.maxWidth||"auto");n["og:video:width"]&&i.attr("width",n["og:video:width"]);n["og:video:height"]&&i.attr("height",n["og:video:height"]);r.append(i)}else if(n["og:image"]){var s=e('<img src="'+n["og:image"]+'">');s.css("max-height",t.maxHeight||"auto").css("max-width",t.maxWidth||"auto");n["og:image:width"]&&s.attr("width",n["og:image:width"]);n["og:image:height"]&&s.attr("height",n["og:image:height"]);r.append(s)}n["og:title"]&&r.append("<b>"+n["og:title"]+"</b><br/>");n["og:description"]?r.append(n["og:description"]+"<br/>"):n.description&&r.append(n.description+"<br/>");return r}}})]})(jQuery);String.prototype.md5=function(){var e=function(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535},t=function(e,t){return e<<t|e>>>32-t},n=function(n,r,i,s,o,u){return e(t(e(e(r,n),e(s,u)),o),i)},r=function(e,t,r,i,s,o,u){return n(t&r|~t&i,e,t,s,o,u)},i=function(e,t,r,i,s,o,u){return n(t&i|r&~i,e,t,s,o,u)},s=function(e,t,r,i,s,o,u){return n(t^r^i,e,t,s,o,u)},o=function(e,t,r,i,s,o,u){return n(r^(t|~i),e,t,s,o,u)},u=function(t){var n,u,a,f,l,c=t.length,h=1732584193,p=-271733879,v=-1732584194,m=271733878;for(l=0;l<c;l+=16){n=h;u=p;a=v;f=m;h=r(h,p,v,m,t[l+0],7,-680876936);m=r(m,h,p,v,t[l+1],12,-389564586);v=r(v,m,h,p,t[l+2],17,606105819);p=r(p,v,m,h,t[l+3],22,-1044525330);h=r(h,p,v,m,t[l+4],7,-176418897);m=r(m,h,p,v,t[l+5],12,1200080426);v=r(v,m,h,p,t[l+6],17,-1473231341);p=r(p,v,m,h,t[l+7],22,-45705983);h=r(h,p,v,m,t[l+8],7,1770035416);m=r(m,h,p,v,t[l+9],12,-1958414417);v=r(v,m,h,p,t[l+10],17,-42063);p=r(p,v,m,h,t[l+11],22,-1990404162);h=r(h,p,v,m,t[l+12],7,1804603682);m=r(m,h,p,v,t[l+13],12,-40341101);v=r(v,m,h,p,t[l+14],17,-1502002290);p=r(p,v,m,h,t[l+15],22,1236535329);h=i(h,p,v,m,t[l+1],5,-165796510);m=i(m,h,p,v,t[l+6],9,-1069501632);v=i(v,m,h,p,t[l+11],14,643717713);p=i(p,v,m,h,t[l+0],20,-373897302);h=i(h,p,v,m,t[l+5],5,-701558691);m=i(m,h,p,v,t[l+10],9,38016083);v=i(v,m,h,p,t[l+15],14,-660478335);p=i(p,v,m,h,t[l+4],20,-405537848);h=i(h,p,v,m,t[l+9],5,568446438);m=i(m,h,p,v,t[l+14],9,-1019803690);v=i(v,m,h,p,t[l+3],14,-187363961);p=i(p,v,m,h,t[l+8],20,1163531501);h=i(h,p,v,m,t[l+13],5,-1444681467);m=i(m,h,p,v,t[l+2],9,-51403784);v=i(v,m,h,p,t[l+7],14,1735328473);p=i(p,v,m,h,t[l+12],20,-1926607734);h=s(h,p,v,m,t[l+5],4,-378558);m=s(m,h,p,v,t[l+8],11,-2022574463);v=s(v,m,h,p,t[l+11],16,1839030562);p=s(p,v,m,h,t[l+14],23,-35309556);h=s(h,p,v,m,t[l+1],4,-1530992060);m=s(m,h,p,v,t[l+4],11,1272893353);v=s(v,m,h,p,t[l+7],16,-155497632);p=s(p,v,m,h,t[l+10],23,-1094730640);h=s(h,p,v,m,t[l+13],4,681279174);m=s(m,h,p,v,t[l+0],11,-358537222);v=s(v,m,h,p,t[l+3],16,-722521979);p=s(p,v,m,h,t[l+6],23,76029189);h=s(h,p,v,m,t[l+9],4,-640364487);m=s(m,h,p,v,t[l+12],11,-421815835);v=s(v,m,h,p,t[l+15],16,530742520);p=s(p,v,m,h,t[l+2],23,-995338651);h=o(h,p,v,m,t[l+0],6,-198630844);m=o(m,h,p,v,t[l+7],10,1126891415);v=o(v,m,h,p,t[l+14],15,-1416354905);p=o(p,v,m,h,t[l+5],21,-57434055);h=o(h,p,v,m,t[l+12],6,1700485571);m=o(m,h,p,v,t[l+3],10,-1894986606);v=o(v,m,h,p,t[l+10],15,-1051523);p=o(p,v,m,h,t[l+1],21,-2054922799);h=o(h,p,v,m,t[l+8],6,1873313359);m=o(m,h,p,v,t[l+15],10,-30611744);v=o(v,m,h,p,t[l+6],15,-1560198380);p=o(p,v,m,h,t[l+13],21,1309151649);h=o(h,p,v,m,t[l+4],6,-145523070);m=o(m,h,p,v,t[l+11],10,-1120210379);v=o(v,m,h,p,t[l+2],15,718787259);p=o(p,v,m,h,t[l+9],21,-343485551);h=e(h,n);p=e(p,u);v=e(v,a);m=e(m,f)}return[h,p,v,m]},a=function(e){var t="0123456789abcdef",n="",r,i=e.length*4;for(r=0;r<i;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n},f=function(e){var t=(e.length+8>>6)+1,n=[],r,i=t*16,s,o=e.length;for(r=0;r<i;r++)n.push(0);for(s=0;s<o;s++)n[s>>2]|=(e.charCodeAt(s)&255)<<s%4*8;n[s>>2]|=128<<s%4*8;n[t*16-2]=o*8;return n};return a(u(f(this)))};