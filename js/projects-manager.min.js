function make_steps_manager_sort_received(e){jQuery(e).hasClass("empty")&&jQuery(e).removeClass("empty").find(".empty").remove()}function make_steps_manager_sort_removed(e){jQuery(e).children().length===0&&jQuery(e).append($('<div class="empty">empty</div>')).addClass("empty")}function make_steps_manager_sort_update(e){make_step_manager_update_steps()}function make_step_manager_update_steps(){var e=0;jQuery(".step-wrapper").each(function(t,n){jQuery(this).attr("id","step-"+e);jQuery("#step-"+e+' > input[type="hidden"]').attr({name:"step-number-"+e,value:e});jQuery("#step-"+e+" .step-title h3").html("Part "+e);jQuery("#step-"+e+" #image-list input.image-url").each(function(){jQuery(this).attr("name","step-images-"+e+"[]")});jQuery("#step-"+e+" #project-header").attr("name","step-title-"+e);jQuery("#step-"+e+" #sub-lists textarea").each(function(){jQuery(this).attr({name:"step-lines-"+e+"[]",id:"line-"+e})});e++})}function make_projects_manager_add_list(){jQuery("#sub-lists img.add").click(function(){var e=jQuery(this).parents(".step-wrapper").children().val(),t=jQuery(this).parent().parent("#sub-lists").children().length+1,n=jQuery(".steps-template .list-template").clone(!0).removeClass("list-template");n.appendTo(jQuery(this).parent().parent("#sub-lists")).find("textarea").attr({id:"line-"+t,name:"step-lines-"+e+"[]"});jQuery(this).remove()})}function make_projects_manager_remove_list(){jQuery("#sub-lists img.remove").click(function(){var e=jQuery(this).parent().parent("#sub-lists");jQuery(this).parent().slideUp(500,function(){jQuery(this).remove();var t=e.find("img.add").length;t===0&&e.find("li:last").append('<img src="'+make_projects_js.stylesheet_uri+'/images/icon-add.png" class="project-button add">');make_projects_manager_add_list()})})}function make_projects_manager_image_removal(){jQuery(".has-image").hover(function(){jQuery(this).children("img.remove-image").fadeIn(100)},function(){jQuery(this).children("img.remove-image").fadeOut(100)});jQuery("img.remove-image").hover(function(){jQuery(this).next().addClass("steps-delete-hover")},function(){jQuery(this).next().removeClass("steps-delete-hover")});jQuery("img.remove-image").click(function(){jQuery(this).parent().removeClass("has-image");jQuery(this).next().attr("src","http://placehold.it/94x94").removeClass("steps-delete-hover").next().attr("value","");jQuery(this).remove()})}function make_projects_manager_view_image(){jQuery(".has-image").hover(function(){jQuery(this).children("img.view-image").fadeIn(100)},function(){jQuery(this).children("img.view-image").fadeOut(100)});jQuery("img.view-image").click(function(e){e.preventDefault();var t=jQuery(this).siblings(".image-url").val();window.open(t,"_blank")})}jQuery(document).ready(function(e){e("#make_magazine_projects_step_manager h3.hndle").prepend('<span class="steps-ico"></span>');e("#image-list .has-image").prepend('<img src="'+make_projects_js.stylesheet_uri+'/images/icon-view.png" class="view-image" /><img src="'+make_projects_js.stylesheet_uri+'/images/icon-remove.png" class="remove-image" />');make_projects_manager_image_removal();make_projects_manager_view_image();e(".add-step").click(function(){var t=e(".step-wrapper").length,n=e(".steps-template").clone(!0).removeClass("steps-template").addClass("hide").attr("id","step-"+t);e('input[name="total-steps"]').val(t);n.appendTo(e(this).parent()).slideDown().find(".step-title h3").html("Step "+t);e("#step-"+t+" li.list-template").removeClass();e("#step-"+t+' > input[type="hidden"]').attr({name:"step-number-"+t,value:t});e("#step-"+t+" #image-list input.image-url").each(function(){e(this).attr("name","step-images-"+t+"[]")});e("#step-"+t+' #list input[name="step-title-0"]').attr("name","step-title-"+t);e("#step-"+t+' #sub-lists textarea[name="step-lines-0[]"]').attr({name:"step-lines-"+t+"[]",id:"line-"+t})}).disableSelection();e(".remove-step").click(function(){e(this).parent().parent().slideUp(500,function(){jQuery(this).remove();make_step_manager_update_steps();var t=e(".step-wrapper").length-1;e('input[name="total-steps"]').val(t)})});e(".steps-step").sortable({placeholder:"ui-state-highlight",items:"div.step-wrapper:not(.steps-template)",axis:"y",receive:function(e,t){make_steps_manager_sort_received(this)},remove:function(e,t){make_steps_manager_sort_removed(this)},update:function(e,t){make_steps_manager_sort_update(this)}});make_projects_manager_add_list();make_projects_manager_remove_list()});(function(e){e(function(){e.fn.make_projects_manager=function(t){var n={button:".steps-image",url:".image-url",preview:".steps-image"},t=e.extend(n,t),r=!0,i=wp.media.editor.send.attachment;e(t.button).click(function(){var n=e(this),s=e(this).siblings(t.url),o=wp.media.editor.send.attachment;r=!0;wp.media.editor.send.attachment=function(e,t){if(!r)return i.apply(this,[e,t]);s.val(t.url).trigger("change")};wp.media.editor.open(n);return!1});e(".add_media").on("click",function(){r=!1});e(t.url).bind("change",function(){var n=this.value,r=e(this).siblings(t.preview);e(r).attr("src",n);e(this).parent().addClass("has-image").prepend('<a href="#" class="view-image"><img src="'+make_projects_js.stylesheet_uri+'/images/icon-view.png" /></a><img src="'+make_projects_js.stylesheet_uri+'/images/icon-remove.png" class="remove-image" />');make_projects_manager_image_removal();make_projects_manager_view_image()})};e(".image-upload").make_projects_manager()})})(jQuery);